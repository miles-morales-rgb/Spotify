<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miles Morales Music - Auto Fetch</title>
    <style>
        :root { --green: #1DB954; --black: #121212; --grey: #282828; --light-grey: #b3b3b3; --border-grey: #3e3e3e; }
        body { background: #000; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .app-container { display: flex; flex: 1; height: calc(100vh - 90px); }
        aside { width: 260px; background: #000; padding: 24px; display: flex; flex-direction: column; gap: 20px; font-weight: bold; }
        .nav-item { color: var(--light-grey); cursor: pointer; transition: 0.2s; }
        .nav-item:hover { color: white; }

        main { flex: 1; background: linear-gradient(to bottom, #1e1e1e, var(--black)); padding: 24px; overflow-y: auto; margin-top: 8px; border-radius: 8px; }
        
        #searchBox { width: 100%; max-width: 350px; padding: 12px 20px; border-radius: 20px; border: none; background: #242424; color: white; margin-bottom: 20px; }

        /* LIST VIEW STYLING */
        .song-list-header { display: grid; grid-template-columns: 50px 1fr 1fr; padding: 10px 16px; color: var(--light-grey); border-bottom: 1px solid var(--border-grey); font-size: 14px; text-transform: uppercase; }
        
        .song-row { 
            display: grid; 
            grid-template-columns: 50px 1fr 1fr; 
            padding: 10px 16px; 
            align-items: center; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: background 0.2s;
        }
        .song-row:hover { background: rgba(255,255,255,0.1); }
        .song-row.active { color: var(--green); }
        .song-index { color: var(--light-grey); }
        .song-title { font-weight: 500; }
        .song-repo { color: var(--light-grey); font-size: 14px; }

        /* Player Bar */
        footer { height: 90px; background: #000; border-top: 1px solid #282828; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; z-index: 100; }
        .current-track { width: 30%; }
        .player-controls { width: 40%; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .btn-play { background: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; font-size: 16px; }
        .progress-box { width: 100%; display: flex; align-items: center; gap: 10px; font-size: 12px; color: var(--light-grey); }
        input[type="range"] { flex: 1; accent-color: var(--green); cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <aside>
        <div style="font-size: 24px; color: white; margin-bottom: 10px;">Spotify¬Æ</div>
        <div class="nav-item">üè† Home</div>
        <div class="nav-item">üîç Search</div>
    </aside>

    <main>
        <input type="text" id="searchBox" placeholder="Search in your GitHub Library..." onkeyup="filterSongs()">
        <h2 id="repo-status">Your GitHub Tracks</h2>
        
        <div class="song-list-header">
            <div>#</div>
            <div>Title</div>
            <div>Source</div>
        </div>
        <div id="list-container">
            <p style="padding: 20px; color: var(--light-grey);">Connecting to GitHub...</p>
        </div>
    </main>
</div>

<footer>
    <div class="current-track">
        <div id="trackName" style="font-weight: bold;">No song selected</div>
        <div id="trackArtist" style="font-size: 12px; color: var(--light-grey);">GitHub Repository</div>
    </div>
    <div class="player-controls">
        <button class="btn-play" id="playBtn" onclick="togglePlay()">‚ñ∂</button>
        <div class="progress-box">
            <span id="currentTime">0:00</span>
            <input type="range" id="progress" value="0" min="0">
            <span id="duration">0:00</span>
        </div>
    </div>
    <div style="width: 30%; text-align: right;">
        <input type="range" style="width: 80px;" oninput="audio.volume = this.value/100">
    </div>
</footer>

<audio id="audio"></audio>

<script>
    const USER = "miles-morales-rgb";
    const REPO = "Music";
    const API_URL = `https://api.github.com/repos/${USER}/${REPO}/contents/`;
    
    let allTracks = []; // Will hold the fetched songs
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const listContainer = document.getElementById('list-container');

    // 1. FETCH MUSIC FROM GITHUB
    async function fetchGitHubMusic() {
        try {
            const response = await fetch(API_URL);
            const files = await response.json();
            
            // Filter for audio files and map them to our format
            allTracks = files
                .filter(file => file.name.match(/\.(mp3|wav|m4a)$/i))
                .map(file => ({
                    title: file.name.replace(/\.[^/.]+$/, "").replaceAll("%20", " "), 
                    src: file.download_url
                }));

            renderList(allTracks);
        } catch (error) {
            listContainer.innerHTML = `<p style="color:red">Failed to load music. Check Repo name or privacy.</p>`;
        }
    }

    // 2. RENDER AS LIST ROWS
    function renderList(songs) {
        listContainer.innerHTML = songs.map((s, index) => `
            <div class="song-row" onclick="loadSong('${s.src}', '${s.title}')">
                <div class="song-index">${index + 1}</div>
                <div class="song-title">${s.title}</div>
                <div class="song-repo">GitHub / ${REPO}</div>
            </div>
        `).join('');
    }

    function loadSong(url, title) {
        audio.src = url;
        audio.play();
        document.getElementById('trackName').innerText = title;
        playBtn.innerText = "‚è∏";
        
        // Visual cue for active row
        document.querySelectorAll('.song-row').forEach(row => {
            row.classList.remove('active');
            if(row.innerText.includes(title)) row.classList.add('active');
        });
    }

    function togglePlay() {
        if (!audio.src) return;
        if (audio.paused) { audio.play(); playBtn.innerText = "‚è∏"; }
        else { audio.pause(); playBtn.innerText = "‚ñ∂"; }
    }

    function filterSongs() {
        const q = document.getElementById('searchBox').value.toLowerCase();
        const filtered = allTracks.filter(s => s.title.toLowerCase().includes(q));
        renderList(filtered);
    }

    // Audio progress logic
    audio.ontimeupdate = () => {
        progress.max = audio.duration || 0;
        progress.value = audio.currentTime;
        document.getElementById('currentTime').innerText = Math.floor(audio.currentTime/60) + ":" + String(Math.floor(audio.currentTime%60)).padStart(2,'0');
        document.getElementById('duration').innerText = audio.duration ? Math.floor(audio.duration/60) + ":" + String(Math.floor(audio.duration%60)).padStart(2,'0') : "0:00";
    };

    // Initial Fetch
    fetchGitHubMusic();
</script>
</body>
</html>
